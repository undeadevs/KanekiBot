const commando = require('discord.js-commando');
var fs = require('fs');
var ytdl = require('ytdl-core');

class playCommand extends commando.Command
{
    constructor(client)
    {
        super(client,{
            name: 'play',
            group: 'music',
            memberName: 'play',
            description: '.'
        });
    }

    async run(message, args)
    {
        if(message.member.voiceChannel)
        {
            if(message.guild.voiceConnection)
            {
                message.member.voiceChannel.join()
                    .then(connection =>{
                        //message.channel.sendMessage("Joined a voice channel.");
                        const dispatcher = connection.playStream(ytdl(args, { filter : 'audioonly' }), { seek: 0, volume: 1 });

                        dispatcher.on('end', () => {
                            dispatcher.on();
                        });

                        /*const dispatcher = connection.playFile('C:/Users/ASUS/Downloads/TokyoGhoul.mp3');

                        dispatcher.on('end', () => {
                            // The song has finished
                            const dispatcher0 = connection.playFile('C:/Users/ASUS/Downloads/Jaiden & Boyinaband - Empty (Official Music Video).mp3');
                            dispatcher0.on('end', () => {
                                const dispatcher1 = connection.playFile('C:/Users/ASUS/Downloads/tPewDiePie - Hej Monika (Club Remix by Party In Backyard) @pewdiepie.mp3');
                                dispatcher1.on('end', () => {

                                });
                            });
                          });
                          
                          dispatcher.on('error', e => {
                            // Catch any errors that may arise
                            console.log(e);
                          });
                          
                          dispatcher.setVolume(0.5); // Set the volume to 50%
                          //dispatcher.setVolume(1); // Set the volume back to 100%
                          
                          //console.log(dispatcher.time); // The time in milliseconds that the stream dispatcher has been playing for
                          
                          //dispatcher.pause(); // Pause the stream
                          //dispatcher.resume(); // Carry on playing
                          
                          //dispatcher.end(); // End the dispatcher, emits 'end' event*/

                    })
            }
        }
        else
        {
            dispatcher.end();
            message.reply("You need to join a voice channel");
        }
    }

}

module.exports = playCommand;